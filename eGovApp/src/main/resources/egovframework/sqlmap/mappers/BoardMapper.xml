<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="BoardMapper">
	<resultMap id="BoardViewMap" type="egovframework.example.main.service.BoardVO">
		<result column="board_id"   property="boardId"/>
		<result column="title"      property="title"/>
		<result column="author"     property="author"/>
  		<result column="created_at" property="createdAt"/>
  		<result column="views"      property="views"/>
	</resultMap>

	<!-- 게시글 작성 -->
	<insert id="insertBoard" parameterType="egovframework.example.main.service.BoardVO" 
			useGeneratedKeys="true" keyProperty="boardId">
		INSERT INTO BOARD(author, title, content, allow_comment)
		VALUES (#{author}, #{title}, #{content}, 
			<if test="allowComment == null">DEFAULT</if>
        	<if test="allowComment != null">#{allowComment}</if>);
	</insert>
	<!-- 첨부파일 추가 -->
	<insert id="insertAttachment" parameterType="egovframework.example.main.service.BoardVO">
		INSERT INTO BOARD_FILE(post_id, file_seq, file_name, file_path, file_size)
		 VALUES(#{postId}, #{fileSeq}, #{fileName}, #{filePath}, #{fileSize})
	</insert>
	
	<!-- 게시글 불러오기 -->
	<select id="boardList" parameterType="egovframework.example.main.service.BoardView" resultMap="BoardViewMap">
		SELECT * FROM BOARD
		WHERE 1=1
			
			<if test="searchType != 0 and searchText != null and searchText != ''">
				  <choose>
            		<when test="searchType == 1"> AND title   LIKE CONCAT('%', #{searchText}, '%') </when>
            		<when test="searchType == 2"> AND author  LIKE CONCAT('%', #{searchText}, '%') </when>
            		<when test="searchType == 3"> AND content LIKE CONCAT('%', #{searchText}, '%') </when>
        		</choose>
			</if>
		ORDER BY board_id DESC
		LIMIT #{firstIndex}, #{pageUnit}
	</select>
	
	<!-- 게시글 총 갯수 조회 -->
	<select id="boardListTot" parameterType="egovframework.example.main.service.BoardView" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM BOARD
		<where>
			<if test="searchType != 0 and searchText != null">
				<choose>
					<when test="searchType == 1"> AND title   LIKE CONCAT('%', #{searchText}, '%') </when>
        			<when test="searchType == 2"> AND author  LIKE CONCAT('%', #{searchText}, '%') </when>
        			<when test="searchType == 3"> AND content LIKE CONCAT('%', #{searchText}, '%') </when>
				</choose>
			</if>
		</where>
	</select>
	
	<!-- 조회수 증가 -->
	<update id="viewCnt" parameterType="int">
		UPDATE BOARD
		SET views = views + 1
     	WHERE board_id = #{boardId}
	</update>
	
	<!-- 게시글 조회 -->
	<select id="boardDetail" parameterType="egovframework.example.main.service.BoardVO" resultMap="BoardViewMap">
		SELECT * FROM BOARD 
		WHERE board_id = #{boardId}
	</select>

	<!-- 첨부파일 조회 -->
	
	<!-- 댓글 조회 -->
</mapper>